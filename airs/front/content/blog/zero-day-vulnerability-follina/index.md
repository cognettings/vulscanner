---
slug: zero-day-vulnerability-follina/
title: 0-Day Vulnerability Dubbed Follina
date: 2022-06-13
subtitle: Chances are you're vulnerable with Microsoft Office
category: attacks
tags: cybersecurity, vulnerability, windows, risk, social-engineering
image: https://res.cloudinary.com/fluid-attacks/image/upload/v1655140929/blog/zero-day-vulnerability-follina/cover_follina.webp
alt: Photo by Lucrezia Carnelos on Unsplash
description: In this blog post, you can learn what Follina is, how it works, what cyberattacks are linked to it and what you can do as prevention measures.
keywords: Follina, Zero Day, Vulnerability, Microsoft Office, Word, MSDT, Windows, Ethical Hacking, Pentesting
author: Felipe Ruiz
writer: fruiz
name: Felipe Ruiz
about1: Cybersecurity Editor
source: https://unsplash.com/photos/5UufAxklqDY
---

The charming cloister we can admire
on the cover of this post
is found in the [Abbazia Cistercense Santa Maria di Follina](https://www.comune.follina.tv.it/home/Vivere/Abbazia-Cistercense.html).
[Follina](https://en.wikipedia.org/wiki/Follina)
is a municipality in the Province of Treviso in northern Italy.
But it is also the name
recently bestowed to a remote code execution vulnerability
in the Microsoft Windows Diagnostic Tool (MSDT).
Cybercriminals are exploiting this zero-day in the wild,
and Microsoft has not yet officially released a patch remediating it.
What exactly is Follina,
and what can we do about it in the meantime to stay safe?

## What is Follina?

[On May 27](https://twitter.com/nao_sec/status/1530196847679401984)
this year,
the Japanese cybersecurity research team [nao_sec](https://nao-sec.org/)
detected a strange [Word document in VirusTotal](https://www.virustotal.com/gui/file/4a24048f81afbe9fb62e7a6a49adbd1faf41f266b5f9feecdceb567aec096784/details)
uploaded two days before [from an IP address](https://www.zdnet.com/article/this-zero-day-windows-flaw-opens-a-backdoor-to-hackers-via-microsoft-word-heres-how-to-fix-it/)
in Belarus.
This *maldoc* contained malicious code
to leverage ["the Word remote template feature](https://doublepulsar.com/follina-a-microsoft-office-code-execution-vulnerability-1a47fce5629e)
to retrieve \[an\] HTML file from a remote \[web server\],
which in turn uses the ms-msdt MSProtocol URI scheme
to load some code and execute PowerShell."
These are the words of cybersecurity expert Kevin Beaumont,
whose attention was drawn to the finding
and who decided to investigate it.
In fact,
it was he who,
recognizing that it was a zero-day vulnerability in the MSDT,
named it Follina.
Why?
Because one of the names of the referenced *maldoc* was "05-2022-0438."
And [0438](https://www.tuttitalia.it/veneto/provincia-di-treviso/36-prefisso/)
is the area code for Follina in Italy.
Plain and simple.

Let's drill down on the issue a bit further.
MSDT,
the affected tool,
[is an application](https://www.kaspersky.com/blog/follina-cve-2022-30190-msdt/44461/)
that automatically collects information on systems
and [sends it](https://docs.microsoft.com/en-us/troubleshoot/sql/general/answers-questions-msdt)
to Microsoft Support for analysis
and determination of solutions
when something appears to be failing in Windows.
Microsoft Word is among the applications
that can call up MSDT through the ms-msdt:/ protocol URI scheme
[to launch](https://www.zdnet.com/article/this-zero-day-windows-flaw-opens-a-backdoor-to-hackers-via-microsoft-word-heres-how-to-fix-it/)
its troubleshooter packs.
URI ([Uniform Resource Identifier](https://en.wikipedia.org/wiki/Uniform_Resource_Identifier))
is a unique sequence of characters
to identify a resource in web technologies.
A URL (Uniform Resource Locator),
for instance,
is a URI that provides the location of a resource for its retrieval.
[URI schemes](https://benjamin-altpeter.de/doc/thesis-electron.pdf)
can be manifold.
Among them,
we have http://, https://, mailto: and file://.
The one that matters to us on this occasion is ms-msdt:/.

For the exploitation of Follina,
the victim receives the Word document created by the attacker
in an email based on a [social engineering](../social-engineering/) ploy
to persuade them to open it.
They do so.
And though it may be a blank file,
it ["contains an external](https://isc.sans.edu/forums/diary/New+Microsoft+Office+Attack+Vector+via+msmsdt+Protocol+Scheme+CVE202230190/28694)
reference pointing to a malicious URL."
(It's a problem
that Office allows unfiltered loading from Word HTML templates
and Outlook links.)
From there,
a payload with the ms-msdt:/ protocol is obtained,
and Microsoft Office automatically processes it but,
in the case reported by Beaumont,
leads to the execution of PowerShell.
The attacker can then execute arbitrary code via PowerShell.
([Here's](https://twitter.com/buffaloverflow/status/1530866518279565312)
a brief illustrative video
where a researcher shows a test of a "*maldoc*" that,
when opened,
leads to the execution of the Windows calculator.)

[Beaumont found](https://www.zdnet.com/article/this-zero-day-windows-flaw-opens-a-backdoor-to-hackers-via-microsoft-word-heres-how-to-fix-it/)
that this could even happen
when [macros](https://support.microsoft.com/en-us/office/create-or-run-a-macro-c6b99036-905c-49a6-818a-dfb98b7c3c9c)
are disabled.
It was enough for the attacker
to convert the document to Rich Text Format (RTF).
Thus,
even with the Office Protected View enabled
(which does not allow macros to be run on docs from the Internet),
[code execution](https://doublepulsar.com/follina-a-microsoft-office-code-execution-vulnerability-1a47fce5629e)
occurred with the victim only previewing the document,
i.e., without opening it.

According to [Journalist Jonathan Creig](https://therecord.media/microsoft-releases-guidance-for-office-zero-day-used-to-target-orgs-in-russia-india-tibet/),
this security issue was actually discovered almost two years ago
in a [bachelor's thesis in Germany](https://benjamin-altpeter.de/doc/thesis-electron.pdf).
Researcher [@BaoshengbinCumt](https://twitter.com/BaoshengbinCumt),
meanwhile,
[said that exploitation](https://twitter.com/BaoshengbinCumt/status/1531473162701258753)
tests began in October 2021
and [the first attack](https://twitter.com/BaoshengbinCumt/status/1531821860744478720)
took place in March this year.
However,
this vulnerability had to [wait until April](https://twitter.com/CrazymanArmy/status/1531117401181671430/photo/1)
to be reported to Microsoft.
It seems it was [@CrazymanArmy](https://twitter.com/CrazymanArmy),
leader of the [Shadow Chaser Group](https://twitter.com/ShadowChasing1),
who did it more than a month before nao_sec's discovery,
delivering to Microsoft [a *maldoc*](https://twitter.com/h2jazi/status/1513870903590936586)
that was being sent to Russian users.
It was disturbing then that
[the company responded](https://twitter.com/CrazymanArmy/status/1531184830171742209/photo/1)
to deny that it was a security issue.
Apparently,
they failed to replicate the exploit,
arguing that a passcode is required when starting [msdt.exe](https://www.file.net/process/msdt.exe.html).
Nevertheless,
when the predicament resurfaced at the end of May,
Microsoft officially spoke out.
They assigned Follina the identifier [CVE-2022-30190](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-30190)
and published a [guidance blog post](https://msrc-blog.microsoft.com/2022/05/30/guidance-for-cve-2022-30190-microsoft-support-diagnostic-tool-vulnerability/)
in which they initially said the following:

<quote-box>

An attacker who successfully exploits this vulnerability
can run arbitrary code with the privileges of the calling application.
The attacker can then install programs,
view, change, or delete data,
or create new accounts in the context allowed by the user's rights.

</quote-box>

<div>
<cta-banner
buttontxt="Read more"
link="/solutions/vulnerability-management/"
title="Get started with Fluid Attacks' Vulnerability Management solution
right now"
/>
</div>

Therefore,
in the case mentioned above,
the privileges of the victim
who received the Word file
were the same as those available to the attacker remotely.
[Beaumont](https://doublepulsar.com/follina-a-microsoft-office-code-execution-vulnerability-1a47fce5629e)
and other security researchers proved Follina in Office 2013,
2016, 2019, 2021, ProPlus and 365.
There's no question we are dealing with a very dangerous vulnerability,
with a high severity level
([apparently](https://thehackernews.com/2022/06/researchers-warn-of-unpatched-dogwalk.html)
a CVSS score of 7.8)
and broad implications
due to the massive use of Microsoft Office worldwide.

## Other attacks associated with Follina exploitation

Once a vulnerability is no longer a closed book,
the number of attacks begins to grow dramatically.
[On May 31](https://therecord.media/microsoft-releases-guidance-for-office-zero-day-used-to-target-orgs-in-russia-india-tibet/),
there was already news of several state-backed threat actors exploiting it.
The security firm Proofpoint,
for example,
reported attacks by a China-linked hacking group
against the Tibetan community.
These cybercriminals used URLs to deliver ZIP archives containing *maldocs*
in which they posed as the [Women's Empowerment Desk](https://www.facebook.com/womenempowermentdesk/)
of the Central Tibetan Administration.
A few days later,
[Proofpoint said](https://twitter.com/threatinsight/status/1532830739208732673)
it had blocked a [phishing](../phishing/) campaign
targeting some of its customers:
government entities in Europe and the U.S.
The lure document to exploit Follina intended to deceive the targets
by talking about salary increases.

<div class="imgblock">

![Image 1](https://res.cloudinary.com/fluid-attacks/image/upload/v1655141165/blog/zero-day-vulnerability-follina/follina_phishing.webp)

<div class="title">

Image taken from [Threat Insight Twitter account](https://twitter.com/threatinsight/status/1532830932511535104/photo/1).

</div>

</div>

On June 7,
[Proofpoint revealed](https://twitter.com/threatinsight/status/1534227444915482625)
having seen the threat actor
they refer to as TA570
exploiting Follina to deliver the QBot (aka Qakbot) trojan.
Attackers send messages with HTML attachments that,
when opened,
download a ZIP file containing an IMG file.
This one,
in turn,
includes Word, DLL and LNK files.
The LNK executes the DLL to start Qbot.
The Word loads and executes from an external server an HTML file
containing PowerShell to abuse Follina
and thus download and run Qbot.
[This trojan](https://therecord.media/hackers-using-follina-windows-zero-day-to-spread-qbot-malware/)
has been widely used to steal banking information
and is tied to several ransomware variants
(e.g., [ProLock, Egregor](https://www.proofpoint.com/us/blog/threat-insight/first-step-initial-access-leads-ransomware),
[Conti, and Black Basta](https://therecord.media/hackers-using-follina-windows-zero-day-to-spread-qbot-malware/)).
The situation with Follina worsens with ransomware groups
now wanting to cash in on it.

## What could you do about it?

So far,
Microsoft has not released a patch for Follina.
It is expected to arrive soon.
What has been recommended up until now are merely temporary workarounds.
In their guidance,
as a preventive measure,
Microsoft suggests disabling the MSDT URL protocol.
Their instructions are as follows:

1. Run **Command Prompt** as **Administrator**.

2. To back up the registry key,
   execute the command `reg export HKEY_CLASSES_ROOT\ms-msdt`*`filename`*.

3. Execute the command `reg delete HKEY_CLASSES_ROOT\ms-msdt /f`.

That second step is essential
so that you can restore the registry key
with the `reg import`*`filename`* command
as soon as this workaround is no longer needed.
Of course,
when the patch is released,
install it as soon as possible.
Microsoft also recommended its customers with Microsoft Defender Antivirus
turn on "cloud-delivered protection and automatic sample submission"
to identify and stop threats.
In addition,
you should be careful with emails sent by unknown senders.
Be very wary of those with Microsoft Office files attached.
If you open them or even see them in preview mode,
you may find yourself in dire straits.

It's worth mentioning that
[free "micropatches" for Follina](https://blog.0patch.com/2022/06/free-micropatches-for-follina-microsoft.html)
were published unofficially by the 0patch team
for different versions of Windows and Windows Server.
Afterward,
[they released micropatches](https://blog.0patch.com/2022/06/microsoft-diagnostic-tools-dogwalk.html)
for another vulnerability dubbed DogWalk.
But why on earth is this relevant?
DogWalk is another zero-day in MSDT.
[A security issue that](https://thehackernews.com/2022/06/researchers-warn-of-unpatched-dogwalk.html),
like Follina,
was discovered in 2020,
was not seen by Microsoft then as a bug
and is now also being dusted off.

**Update (June 14):**
Microsoft has officially released the patch for Follina.
[They say the following](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-30190):

<quote-box>

The update for this vulnerability
is in the June 2022 cumulative Windows Updates.
Microsoft strongly recommends that
customers install the updates
to be fully protected from the vulnerability.
Customers whose systems are configured to receive automatic updates
do not need to take any further action.

</quote-box>
