---
schema;vulnerability_attributes:
  type: map
  mapping: &vulnerability_attributes
    cvss_v3:
      type: str
      pattern: ^CVSS:3[.]1/((AV:[NALP]|AC:[LH]|PR:[NLH]|UI:[NR]|S:[UC]|[CIA]:[NLH]|E:[XUPFH]|RL:[XOTWU]|RC:[XURC]|[CIA]R:[XLMH]|MAV:[XNALP]|MAC:[XLH]|MPR:[XNLH]|MUI:[XNR]|MS:[XUC]|M[CIA]:[XNLH])/)*(AV:[NALP]|AC:[LH]|PR:[NLH]|UI:[NR]|S:[UC]|[CIA]:[NLH]|E:[XUPFH]|RL:[XOTWU]|RC:[XURC]|[CIA]R:[XLMH]|MAV:[XNALP]|MAC:[XLH]|MPR:[XNLH]|MUI:[XNR]|MS:[XUC]|M[CIA]:[XNLH])$
      required: false
    cwe_ids:
      type: seq
      sequence:
        - type: str
          pattern: ^CWE-[0-9]{1,4}$
          required: true
      required: false
    repo_nickname:
      type: str
      required: true
    source:
      type: str
      enum: [analyst, customer, deterministic, escape, machine]
      required: true
    state:
      type: str
      enum: [open, closed, rejected, submitted]
      required: true
    tool:
      type: map
      required: true
      mapping:
        name:
          type: str
          required: true
        impact:
          type: str
          required: true
          enum: [direct, indirect]
    tags:
      type: seq
      sequence:
        - type: str

type: map
mapping:
  inputs:
    type: seq
    sequence:
      - type: map
        mapping:
          commit_hash:
            pattern: ^([a-f0-9]{40})$
            required: false
            type: str
          stream:
            type: str
            pattern: ^(\b[\w-]{1,30}\b)+(,\b[\w-]{1,30}\b){0,9}$
            required: true
          field:
            type: str
            pattern: ^.{0,1000}$
            required: false
          url:
            type: str
            pattern: ^.{1,1000}$
            required: true
          skims_method:
            type: str
            pattern: ^[\w]+\.[\w]+$
            required: false
          skims_technique:
            type: str
            pattern: ^[\w]{3,5}$
            required: false
          developer:
            type: str
            pattern: ^[\w]+\@fluidattacks.com$
            required: false
          <<: *vulnerability_attributes
  lines:
    type: seq
    sequence:
      - type: map
        mapping:
          commit_hash:
            pattern: ^([a-f0-9]{40})$
            required: true
            type: str
          line:
            type: str
            pattern: ^[0-9]+(?:-[0-9]+)?(,[0-9]+(?:-[0-9]+)?)*$
            required: true
          path:
            type: str
            pattern: ^(?=.{1,1000}$)+(?!=)+([^/][^/]+/([^/]+/?)+)|([^\\]+\\([^\\]+\\?)+)|^([^/]+)$
            required: true
          skims_method:
            type: str
            pattern: ^[\w]+\.[\w]+$
            required: false
          skims_technique:
            type: str
            pattern: ^[\w]{3,5}$
            required: false
          developer:
            type: str
            pattern: ^[\w]+\@fluidattacks.com$
            required: false
          <<: *vulnerability_attributes
  ports:
    type: seq
    sequence:
      - type: map
        mapping:
          host:
            type: str
            pattern: ^.{1,1000}$
            required: true
          port:
            type: str
            pattern: ^[0-9]+(?:-[0-9]+)?(,[0-9]+(?:-[0-9]+)?)*$
            required: true
          <<: *vulnerability_attributes
