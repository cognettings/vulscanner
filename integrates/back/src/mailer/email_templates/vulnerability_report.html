{% extends "layouts/common.html" %}
  {% from 'layouts/components/forms.html' import banner_magnifying, go_to_button %}
  {% block layout %}
    <div class="container">
      {% include 'layouts/components/dark_logo_header.html' %}

      {{ banner_magnifying('Vulnerability Alert') }}
      <div class="main-content">
        <h2>Hello {{ name }},</h2>
        <p>
          New vulnerabilities
          in the group <strong>{{ group }}</strong>
          have been <strong>{{ state }}</strong>
          {%- if is_escape %}
          by
          <strong><a
            href="mailto:{{ responsible }}"
            target="_blank"
            rel="noopener noreferrer"
          >
            {{ responsible -}}
          </a></strong>
          as escape
          {%- endif -%}:
        </p>
        <div class="data-container">
          <p>
            <strong>Type:</strong><br/>{{ finding }}<br/><br/>
            <strong>Severity (CVSSv3.1):</strong><br/>{{ severity_score }} - {{ severity_level }}
            {%- if remaining_exposure -%}
            <br/><br/>
            <strong>Remaining exposure (CVSSF):</strong><br/>{{ remaining_exposure }}
            {% endif %}
          </p>
            {% for repo_name, vulnerabilities in vulns_props.items() %}
          <p>
              {% if not is_escape %}
              <br/>
            <strong>{{ repo_name }}:</strong>
            <ul class="big-list-icon">
                {% for prop_key, prop_value in vulnerabilities.items() %}
              <li>
                {{ prop_value["location"].replace("()", "") }}
                  {% if prop_value["specific"] %}
                ({{ prop_value["specific"] }})
                  {% endif %}
              </li>
              <ul>
                  {% for key, value in prop_value.items() %}
                    {% if key not in ["location", "specific", "source"] %}
                <li><strong>{{ key.capitalize() }}:</strong> {{ value }}</li>
                    {% endif %}
                  {% endfor %}
              </ul>
                {% endfor %}
            </ul>
              {% elif "ESCAPE" in vulnerabilities.values() | map(attribute="source") %}
            <br/>
            <strong>{{ repo_name }}:</strong>
            <ul class="big-list-icon">
                {% for prop_key, prop_value in vulnerabilities.items() %}
                  {% if is_escape and prop_value["source"] == "ESCAPE" %}
              <li>
                {{ prop_value["location"].replace("()", "") }}
                    {% if prop_value["specific"] %}
                ({{ prop_value["specific"] }})
                    {% endif %}
                <strong>({{ prop_value["source"].lower() }})</strong>
              </li>
                  {% endif %}
                {% endfor %}
            </ul>
              {% endif %}
          </p>
            {% endfor %}
        </div>
        {{ go_to_button('Go to type of vulnerability', finding_url, 'primary-button') }}
      </div>
      {% include 'layouts/components/footer.html' %}

    </div>
  {% endblock %}
